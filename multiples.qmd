---
title: "Valuation Multiples"
execute:
  echo: false
---

**Overview**

Investors often use valuation multiples, tools that measure financial metrics as ratios of each other, to analyze stocks.

```{r}
#| label: setup
#| message: false

library(tidyverse)
library(scales)

financials <- 
read_csv("financials.csv") |>
janitor::clean_names() |>
mutate(percent_eps = earnings_share / price)

#removed outliers to better visualize eps
Q1 <- quantile(financials$percent_eps, 0.25, na.rm = TRUE)
Q3 <- quantile(financials$percent_eps, 0.75, na.rm = TRUE)
IQR <- Q3 - Q1
lower <- Q1 - 1.5 * IQR
upper <- Q3 + 1.5 * IQR

#removed outliers for price_earnings
Q1 <- quantile(financials$price_earnings, 0.25, na.rm = TRUE)
Q3 <- quantile(financials$price_earnings, 0.75, na.rm = TRUE)
IQR <- Q3 - Q1
lower1 <- Q1 - 1.5 * IQR
upper1 <- Q3 + 1.5 * IQR

#removed outliers for price_book 
Q1 <- quantile(financials$price_book, 0.25, na.rm = TRUE)
Q3 <- quantile(financials$price_book, 0.75, na.rm = TRUE)
IQR <- Q3 - Q1
lower2 <- Q1 - 1.5 * IQR
upper2 <- Q3 + 1.5 * IQR

#removing all outliers
financials_filtered <- financials |>
  filter(percent_eps >= lower, percent_eps <= upper,
         price_earnings >= lower1, price_earnings <=              upper1, price_book >= lower2, price_book <=              upper2)

#removing non-finite values
financials_filtered2 <- financials_filtered %>%
  filter(is.finite(ebitda) & is.finite(price_earnings) & ebitda > 0)

```
**Analysis**

The price/earnings or p/e ratio is a company's current share price divided by its earnings per share. It offers insight into a company's profits. A high p/e ratio could suggest that a stock's market price is high compared to its earnings, implying the stock is overvalued. Conversely, a low p/e ratio could suggest the opposite.

```{r}
#| label: sector_to_pe
#| message: false 
#need analysis 
financials_filtered |>
  ggplot(aes(x = price_earnings,
             y = fct_reorder(sector, price_earnings)))+
  geom_boxplot() +
  scale_x_continuous(breaks = seq(0, 45, by = 5)) +
  coord_cartesian(xlim = c(0, 45), expand = FALSE) +
  labs(title = "Price/Earnings Ratio by Sector",
       x = "Price/Earnings",
       y = NULL) +
  theme_minimal()
```

The price to book or p/b ratio is a company's current share price divided by its book value per share, or net assets divided by number of shares. It offers insight into a company's value. A high p/b ratio could indicate that a stock is overvalued, while a low p/b ratio could indicate the opposite. 

```{r}
#| label: sector to pb 
#| message: false
#need analysis 
financials_filtered2 |>
  ggplot(aes(x = price_book, y = fct_reorder(sector, price_book,
                                             .na_rm = TRUE))) +
  geom_boxplot() + scale_x_continuous(breaks = seq(0, 45, by = 5)) +
  coord_cartesian(xlim = c(0, 40), expand = FALSE) +
    labs(title = "Price/Book Ratio by Sector",
       x = "Price/Book",
       y = NULL) +
  theme_minimal()
```
EBITDA, or earnings before interest, taxes, depreciation, and amortization, is a widely used measure of the profit generated by a company's operations. Investors use EBITDA to assess the strength of a company's performance.

```{r}
#make scale and line best fit less gross + analysis
#| label: sector_pe_ebitda
#| message: false
financials_filtered2 |> drop_na() |>
  ggplot(aes(y = price_earnings,
             x = ebitda,
             color = sector)) +
  geom_point(alpha = 0.6,  size = 0.7) +
  geom_smooth(method = lm, se = FALSE,
              formula = 'y ~ x',
              aes(color = FALSE)) +
  scale_x_log10(labels = scales::comma_format(),
                ) +
  scale_y_continuous(breaks = seq(0, 45, by = 10)) +
  coord_cartesian(ylim = c(0, 45), expand = FALSE) +
  theme_minimal() +
  theme(legend.position = "bottom") +
  labs(title = "Price/Earnings and EBITDA by Sector",
       x = "EBTIDA",
       y = "Price/Earnings Ratio",
       color = NULL)
```

